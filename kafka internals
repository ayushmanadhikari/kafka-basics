Internal Working of Kafka

Kafka Controllers
.kafka broker that is responsible for electing parition leaders
.first broker that starts the cluster becomes the controller by creating a ephemeral node in zookeeper called controller
.when controller broker's connection is lost, the ephemeral node will disappear
.when other brokers are notfied through Zookeeper, they will attempt to create the controller node in Zookeeper themselves
.when controller notices that a broker left the cluster, it knows that all the partitions that had leader on that broker will now need a new leader
.it goes to all the partitions who lost their leader and create a new leader


From ZooKeeper to KRaft - Kafka's new Raft based controller
.kafka is now making its move towards new controller from the ZooKeeper based controller for several reasons
.Zookeeper has 2 main functions while running Kafka 
	-storing cluster metadata like topic, paritions, offset, etc
	-electing a new controller
.these 2 functionalities will be handled by Raft algorithm
.Raft algorithm elects a new leader
.Raft is a log of metadata events which contains info about each change to the cluster metadata




Replication
.replication ensures high availability and durability
.data is kafka is organized into topics which is in turn paritioned and each partition can have multiple replicas
.these replicas are stored on brokers
.and each broker typically stores hundreds or even thousands of replicas belonging to different topics and partitions

Leader Replica
.each parition has a single replica designated as the leader
.it knows which of the follower replicas is up-to-date with the leader
.all produce requests go through the leader to guarantee consistency
.clients can consume from either the lead replica or its followers

Follower Replica
.all replicas for a partition that are not leaders
.they don't serve client requests
.their only job is to replicate messages from the leader and stay up-to-date with most recent messages the leader has
.when leader crashes, one of the follower becomes the next leader
















